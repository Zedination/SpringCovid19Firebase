<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
    <!-- Google Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap">
    <!-- Bootstrap core CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/css/bootstrap.min.css" rel="stylesheet">
    <!-- Material Design Bootstrap -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/css/mdb.min.css" rel="stylesheet">
    <style>
        .main-content {
            margin-top: 100px;
        }

        .canhiem-text {
            color: red;
        }

        .hoiphuc-text {
            color: green;
        }

        .center {
            text-align: center;
        }

        .content-news div.col-md-12 {
            margin-top: 10px;
        }
    </style>
    <title>Trang chủ</title>
</head>

<body>
    <nav class="navbar fixed-top navbar-expand-lg navbar-dark blue scrolling-navbar">
        <a class="navbar-brand" href="#"><i class="fas fa-viruses"></i><strong>COVID-19</strong></a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="#"><i class="fas fa-home"></i> Trang chủ<span
                            class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" data-toggle="modal" data-target="#modalLoginForm"><i
                            class="fas fa-sign-in-alt"></i> Đăng nhập</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" data-toggle="modal" data-target="#modalRegisterForm"><i
                            class="fas fa-user-plus"></i> Đăng ký</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/bookmark" id="bookmark-link"><i class="far fa-bookmark"></i> Tin xem sau</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" id="sign-out"><i class="fas fa-sign-out-alt"></i> Đăng xuất</a>
                </li>
            </ul>
            <ul class="navbar-nav nav-flex-icons">
                <li class="nav-item">
                    <a class="nav-link"><i class="fab fa-facebook-f"></i></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link"><i class="fab fa-twitter"></i></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link"><i class="fab fa-instagram"></i></a>
                </li>
            </ul>
        </div>
    </nav>
    <div class="container-fluid main-content">
        <div class="row">
            <div class="col-md-4 col-12">
                <div class="card">

                    <!-- Card image -->
                    <div class="view overlay">
                        <img class="card-img-top"
                            src="https://static.bangkokpost.com/media/content/20200314/c1_1878770.jpg"
                            alt="Card image cap">
                        <a href="#!">
                            <div class="mask rgba-white-slight"></div>
                        </a>
                    </div>
                    <!-- Card content -->
                    <div class="card-body">

                        <!-- Title -->
                        <h4 class="card-title" style="text-align: center; color: green;"><a>Thống kê dịch Covid-19 Việt
                                Nam</a></h4>
                        <!-- Text -->
                        <div class="row">
                            <div class="col-md-4 col-12">
                                <!-- Card -->
                                <div class="card">
                                    <!-- Card content -->
                                    <div class="card-body">

                                        <!-- Title -->
                                        <h4 class="card-title canhiem-text center">Ca nhiễm</h4>
                                        <!-- Text -->
                                        <h3 class="canhiem-text center" id="canhiem-data">loading...</h3>
                                    </div>

                                </div>
                                <!-- Card -->
                            </div>
                            <div class="col-md-4 col-12">
                                <!-- Card -->
                                <div class="card">
                                    <!-- Card content -->
                                    <div class="card-body">

                                        <!-- Title -->
                                        <h4 class="card-title tuvong-text center">Tử vong</h4>
                                        <!-- Text -->
                                        <h3 class="tuvong-text center" id="tuvong-data">loading...</h3>
                                    </div>

                                </div>
                                <!-- Card -->
                            </div>
                            <div class="col-md-4 col-12">
                                <!-- Card -->
                                <div class="card">
                                    <!-- Card content -->
                                    <div class="card-body">

                                        <!-- Title -->
                                        <h4 class="card-title hoiphuc-text center">Hồi phục</h4>
                                        <!-- Text -->
                                        <h3 class="hoiphuc-text center" id="hoiphuc-data">loading...</h3>
                                    </div>

                                </div>
                                <!-- Card -->
                            </div>
                            <div class="form-group col-md-12 col-12" style=" margin-top: 30px;">
                                <label for="search-data-vietnam">Tìm kiếm</label>
                                <input type="text" class="form-control" id="search-data-vietnam"
                                    aria-describedby="search-data-vietnam" placeholder="Tìm kiếm...">
                            </div>

                            <div class="col-md-12 col-12" style="height: 340px; overflow: auto;">
                                <table class="table table-striped table-covid-vietnam">
                                    <thead>
                                        <tr>
                                            <th scope="col">Địa phương</th>
                                            <th scope="col" class="canhiem-text">Ca nhiễm</th>
                                            <th scope="col" class="tuvong-text">Tử vong</th>
                                            <th scope="col" class="hoiphuc-text">Hồi phục</th>
                                        </tr>
                                    </thead>
                                    <tbody class="ant-table-tbody">
                                        <div class="d-flex justify-content-center">
                                            <div class="spinner-border" role="status" style="display: none;"
                                                id="spinner-datavietnam">
                                                <span class="sr-only">Loading...</span>
                                            </div>
                                        </div>
                                    </tbody>
                                </table>
                            </div>

                        </div>


                    </div>

                </div>
            </div>
            <div class="col-md-4 col-12">
                <!-- Card -->
                <div class="card">

                    <!-- Card image -->
                    <div class="view overlay">
                        <img class="card-img-top"
                            src="https://www.deccanherald.com/sites/dh/files/article_images/2020/05/01/iStock-1203187628-1587175009-1588297243.jpg"
                            alt="Card image cap">
                        <a href="#!">
                            <div class="mask rgba-white-slight"></div>
                        </a>
                    </div>

                    <!-- Card content -->
                    <div class="card-body">

                        <!-- Title -->
                        <h4 class="card-title center" style="color: orange;">Thống kê dịch Covid-19 trên thế giới</h4>
                        <!-- Text -->
                        <div class="row">
                            <div class="col-md-4 col-12">
                                <!-- Card -->
                                <div class="card">
                                    <!-- Card content -->
                                    <div class="card-body">

                                        <!-- Title -->
                                        <h4 class="card-title canhiem-text center">Ca nhiễm</h4>
                                        <!-- Text -->
                                        <p class="canhiem-text center" id="canhiem-data-global">loading...</p>
                                        <p class="canhiem-text center" id="new-canhiem-global"><i
                                                class="fas fa-arrow-up"></i> loading...</p>
                                    </div>

                                </div>
                                <!-- Card -->
                            </div>
                            <div class="col-md-4 col-12">
                                <!-- Card -->
                                <div class="card">
                                    <!-- Card content -->
                                    <div class="card-body">

                                        <!-- Title -->
                                        <h4 class="card-title tuvong-text center">Tử vong</h4>
                                        <!-- Text -->
                                        <p class="tuvong-text center" id="tuvong-data-global">loading...</p>
                                        <p class="tuvong-text center" id="new-tuvong-global"><i
                                                class="fas fa-arrow-up"></i> loading...</p>
                                    </div>

                                </div>
                                <!-- Card -->
                            </div>
                            <div class="col-md-4 col-12">
                                <!-- Card -->
                                <div class="card">
                                    <!-- Card content -->
                                    <div class="card-body">

                                        <!-- Title -->
                                        <h4 class="card-title hoiphuc-text center">Hồi phục</h4>
                                        <!-- Text -->
                                        <p class="hoiphuc-text center" id="hoiphuc-data-global">loading...</p>
                                        <p class="hoiphuc-text center" id=new-hoiphuc-global><i
                                                class="fas fa-arrow-up"></i> loading...</p>
                                    </div>

                                </div>
                                <!-- Card -->
                            </div>
                            <div class="form-group col-md-12 col-12" style=" margin-top: 30px;">
                                <label for="search-data-global">Tìm kiếm</label>
                                <input type="text" class="form-control" id="search-data-global"
                                    aria-describedby="search-data-global" placeholder="Tìm kiếm...">
                            </div>

                            <div class="col-md-12 col-12" style="height: 300px; overflow: auto;">
                                <table class="table table-striped table-covid-global">
                                    <div class="d-flex justify-content-center">
                                        <div class="spinner-border" role="status" style="display: none;"
                                            id="spinner-dataglobal">
                                            <span class="sr-only">Loading...</span>
                                        </div>
                                    </div>
                                </table>
                            </div>
                        </div>

                    </div>

                </div>
                <!-- Card -->
            </div>
            <div class="col-md-4 col-12">
                <div class="card">

                    <!-- Card image -->
                    <div class="view overlay">
                        <img class="card-img-top"
                            src="https://www.coe.int/documents/365513/10877703/statement-covid19-press-freedom-1-870x489.jpg/b3b6854f-13fe-c0ae-cccc-e44d757ce844?t=1585898204000"
                            alt="Card image cap">
                        <a href="#!">
                            <div class="mask rgba-white-slight"></div>
                        </a>
                    </div>

                    <!-- Card content -->
                    <div class="card-body">

                        <!-- Title -->
                        <h4 class="card-title center">Tin tức Covid-19 mới nhất</h4>
                        <!-- Text -->
                        <div class="row content-news" style="margin-top: 20px; height: 650px; overflow: auto;">
                            <div class="d-flex justify-content-center col-md-12">
                                <div class="spinner-border" role="status" style="display: none;" id="spinner-news">
                                    <span class="sr-only">Loading...</span>
                                </div>
                            </div>
                        </div>

                    </div>

                </div>
            </div>
        </div>
    </div>
    <!--Modal Login-->
    <div class="modal fade" id="modalLoginForm" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header text-center">
                    <h4 class="modal-title w-100 font-weight-bold">Đăng nhập</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body mx-3">
                    <div class="md-form mb-5">
                        <i class="fas fa-envelope prefix grey-text"></i>
                        <input type="email" id="email-for-auth" class="form-control validate">
                        <label data-error="wrong" data-success="right" for="defaultForm-email">Email</label>
                    </div>

                    <div class="md-form mb-4">
                        <i class="fas fa-lock prefix grey-text"></i>
                        <input type="password" id="pass-for-auth" class="form-control validate">
                        <label data-error="wrong" data-success="right" for="defaultForm-pass">Password</label>
                    </div>

                </div>
                <div class="modal-footer d-flex justify-content-center">
                    <button class="btn btn-default" id="button-login">
                        <span class="spinner-border spinner-border-sm" style="display: none;" role="status"
                            aria-hidden="true"></span>
                        &nbsp;Đăng nhập</button>
                </div>
            </div>
        </div>
    </div>
    <!--Modal Sign Up-->
    <div class="modal fade" id="modalRegisterForm" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header text-center">
                    <h4 class="modal-title w-100 font-weight-bold">Đăng ký tài khoản mới</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body mx-3">
                    <div class="md-form mb-5">
                        <i class="fas fa-envelope prefix grey-text"></i>
                        <input type="email" id="email-for-register" class="form-control validate">
                        <label data-error="wrong" data-success="right" for="orangeForm-email">Email</label>
                    </div>

                    <div class="md-form mb-4">
                        <i class="fas fa-lock prefix grey-text"></i>
                        <input type="password" id="pass-for-register" class="form-control validate">
                        <label data-error="wrong" data-success="right" for="orangeForm-pass">Password</label>
                    </div>

                </div>
                <div class="modal-footer d-flex justify-content-center">
                    <button class="btn btn-deep-orange" id="button-sign-up">Đăng ký</button>
                </div>
            </div>
        </div>
    </div>
    <!-- JQuery -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- Bootstrap tooltips -->
    <script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.4/umd/popper.min.js"></script>
    <!-- Bootstrap core JavaScript -->
    <script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/js/bootstrap.min.js"></script>
    <!-- MDB core JavaScript -->
    <script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/js/mdb.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyALyG89PJNAflSxuoi0BFptvSkRdTSjpaA&callback=initMap"
        async defer></script>
    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/7.16.0/firebase-app.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
    <script src="https://www.gstatic.com/firebasejs/7.16.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.16.0/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.16.0/firebase-firestore.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/7.16.0/firebase-database.min.js"></script>
    <script>
        $('#bookmark-link').hide();
        $('#sign-out').hide();
    </script>
    <script>
        // Your web app's Firebase configuration
        var firebaseConfig = {
            apiKey: "AIzaSyAeffnJEV2RbXbEBsTjV_ykLq5ymOOshZw",
            authDomain: "covid-firebase-400e4.firebaseapp.com",
            databaseURL: "https://covid-firebase-400e4.firebaseio.com",
            projectId: "covid-firebase-400e4",
            storageBucket: "covid-firebase-400e4.appspot.com",
            messagingSenderId: "259096144507",
            appId: "1:259096144507:web:efdd3874c4aa4db64fd0de",
            measurementId: "G-M2RCZ9S956"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        firebase.analytics();
        var database = firebase.database();
        function writePost(postId, title, content) {
            firebase.database().ref('BOOKMARK/' + postId).set({
                title: title,
                content: content
            })
        }
        function loginFirebase(email, password) {
            if (email && password) {
                firebase.auth().signInWithEmailAndPassword(email, password).then(() => {
                    $('#modalLoginForm').modal('hide');
                    alert("Đăng nhập thành công!");
                }).catch(function (error) {
                    var errorCode = error.code;
                    var errorMessage = error.message;
                    console.log(error);
                    switch (errorCode) {
                        case 'auth/invalid-email':
                            alert("Email không hợp lệ!");
                            break;
                        case 'auth/user-disabled':
                            alert("Tài khoản đã bị khóa!");
                            break;
                        case 'auth/user-not-found':
                            let a = confirm("Tài khoản chưa được đăng ký, bạn có muốn đăng ký tài khoản mới không?");
                            if (a) {
                                $('#modalRegisterForm').modal('show');
                                $('#email-for-register').val(email);
                                $('#pass-for-register').val(password);
                            }
                            break;
                        default:
                            alert("Sai mật khẩu, vui lòng nhập lại!");
                            break;
                    }
                });
            } else {
                alert("Vui lòng điền đầy đủ tài khoản và mật khẩu!");
            }
        }
        function signUpFirebase(email, password) {
            if (email && password) {
                firebase.auth().createUserWithEmailAndPassword(email, password).then(() => {
                    $('#modalRegisterForm').modal('hide');
                    alert('Đăng ký tài khoản thành công!')
                }).catch(function (error) {
                    // Handle Errors here.
                    var errorCode = error.code;
                    var errorMessage = error.message;
                    console.log(error);
                    switch (errorCode) {
                        case 'auth/email-already-in-use':
                            alert("Email này đã được đăng ký rồi, vui lòng đăng ký lại với email khác!");
                            break;
                        case 'auth/invalid-email':
                            alert("Email không hợp lệ!");
                            break;
                        case 'auth/weak-password':
                            alert("Mật khẩu quá ngắn!");
                            break;
                        default:
                            alert('email/password accounts are not enabled');
                            break;
                    }
                });
            } else {
                alert("Vui lòng điền đầy đủ tài khoản và mật khẩu!");
            }
        }
        firebase.auth().onAuthStateChanged(function (user) {
            if (user) {
                $('#sign-out').show();
                $('.content-news .bookmark').show();
                $('#bookmark-link').show();
            } else {
                $('#sign-out').hide();
                $('.content-news .bookmark').hide();
                $('#bookmark-link').hide();
            }
        });
        function signOut() {
            firebase.auth().signOut().then(function () {
                alert("Đăng xuất thành công!");
            }).catch(function (error) {
                alert("Đăng xuất thất bại");
                console.log(error);
            });
        }
    </script>
    <script>
        function getDataVietNam() {
            $('#spinner-datavietnam').show();
            $.ajax({
                url: '/covid-19-vietnam',
                type: 'get',
                success: (data) => {
                    $('#canhiem-data').text(data.caNhiem);
                    $('#tuvong-data').text(data.tuVong);
                    $('#hoiphuc-data').text(data.hoiPhuc);
                    $('.ant-table-tbody').html(data.contentHtml);
                    $('#spinner-datavietnam').hide();
                },
                error: () => {
                    $('#canhiem-data').text('lỗi');
                    $('#tuvong-data').text('lỗi');
                    $('#hoiphuc-data').text('lỗi');
                    $('.ant-table-tbody').html('<p class = "center">Không có dữ liệu</p>');
                    $('#spinner-datavietnam').hide();
                }
            })
        }
        function getDataWorld() {
            $('#spinner-dataglobal').show();
            $.ajax({
                url: 'https://api.covid19api.com/summary',
                type: 'get',
                success: (data) => {
                    let htmlContent = '<thead> <tr> <th scope="col">Quốc gia</th> <th scope="col" style="color: red;">Ca nhiễm</th> <th scope="col">Tử vong</th> <th scope="col" style="color: green;">Hồi phục</th> </tr></thead> <tbody>';
                    $('#canhiem-data-global').text(data.Global.TotalConfirmed);
                    $('#tuvong-data-global').text(data.Global.TotalDeaths);
                    $('#hoiphuc-data-global').text(data.Global.TotalRecovered);
                    $('#new-canhiem-global').html('<i class="fas fa-arrow-up"></i>' + ' ' + data.Global.NewConfirmed);
                    $('#new-tuvong-global').html('<i class="fas fa-arrow-up"></i>' + ' ' + data.Global.NewDeaths);
                    $('#new-hoiphuc-global').html('<i class="fas fa-arrow-up"></i>' + ' ' + data.Global.NewRecovered);
                    data.Countries.forEach(element => {
                        htmlContent += '<tr> <td>' + element.Country + '</td> <td style = "color: red">' + element.TotalConfirmed + '</td><td>' + element.TotalDeaths + '</td><td style = "color: green;">' + element.TotalRecovered + '</td></tr>'
                    });
                    htmlContent += '</tbody>'
                    $('.table-covid-global').html(htmlContent);
                    $('#spinner-dataglobal').hide();
                },
                error: () => {
                    $('#canhiem-data-global').text('lỗi');
                    $('#tuvong-data-global').text('lỗi');
                    $('#hoiphuc-data-global').text('lỗi');
                    $('.table-covid-global').html('<p class = "center">Không có dữ liệu</p>');
                    $('#spinner-dataglobal').hide();
                }
            });
        }
        function filterDataGlobal() {
            $("#search-data-global").on("keyup", function () {
                var value = $(this).val().toLowerCase();
                $(".table-covid-global tr").filter(function () {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                });
            });
        }
        function filterDataVietnam() {
            $("#search-data-vietnam").on("keyup", function () {
                var value = $(this).val().toLowerCase();
                $(".table-covid-vietnam tr").filter(function () {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                });
            });
        }
        function getNews() {
            $('#spinner-news').show();
            $.ajax({
                url: '/news-covid-19',
                type: 'get',
                success: data => {
                    let html = '';
                    data.forEach(e => {
                        html += '<div class="col-md-12 col-12" style="padding-bottom: 10px; border-bottom: 1px solid #ccc; position: relative;"> <div class="row"> <img class="col-md-4 col-4" src="' + e.imgSource + '" alt=""> <div class="detail col-md-8 col-8"> <a href="' + e.link + '" target="blank" style="font-size: 14px; text-decoration: none;">' + e.title + '</a> <p style="font-size: 11px; position: absolute; bottom: -18px;">' + e.source + '</p><button onclick = "saveNews(this)" class="bookmark" style="position: absolute; bottom: -11px;right: 0px;"><i class="fas fa-bookmark"></i></button></div></div></div>'
                    })
                    $('.content-news').html(html);
                    $('#spinner-news').hide();
                    checkCurrentUser();
                }, error: () => {
                    $('.content-news').html('<p class = "center">Không có dữ liệu</p>');
                    $('#spinner-news').hide();
                }
            })
        }
        function timeStampstoDateTime(timeStamps) {
            let time = new Date(timeStamps).toLocaleDateString("vi-VN");
            let date = new Date(timeStamps).toLocaleTimeString("vi-VN");
            let string = time + " " + date;
            return string;
        }
        function writeDataBookmark(id, link, title, source, timestamps, uid) {
            firebase.database().ref('BOOKMARK/' + id).set({
                link: link,
                title: title,
                source: source,
                time: timestamps,
                uid: uid
            }).then(() => {
                alert("Lưu tin thành công!");
            }).catch(() => {
                alert("Lưu tin thất bại!");
            })
        }
        function saveNews(element) {
            let a = element.parentElement;
            let link = a.getElementsByTagName('a')[0].href;
            let title = a.getElementsByTagName('a')[0].text;
            let source = a.getElementsByTagName('p')[0].innerHTML;
            let time = new Date().getTime();
            let id = "id" + time.toString();
            let user = firebase.auth().currentUser;
            writeDataBookmark(id, link, title, source, time, user.uid);
        }
        function checkCurrentUser() {
            var user = firebase.auth().currentUser;
            if (user) {
                $('.content-news .bookmark').show();
            } else {
                $('.content-news .bookmark').hide();
            }
        }
        $(() => {
            getDataVietNam();
            filterDataVietnam();
            getDataWorld();
            filterDataGlobal();
            getNews();
        })
        $('#button-login').click(() => {
            let email = $('#email-for-auth').val();
            let pass = $('#pass-for-auth').val();
            loginFirebase(email, pass);
        });
        $('#button-sign-up').click(() => {
            let email = $('#email-for-register').val();
            let pass = $('#pass-for-register').val();
            signUpFirebase(email, pass);
        });
        $('#sign-out').click(() => {
            let a = confirm("Bạn có muốn đăng xuất không?");
            if (a) {
                signOut();
            }
        });
    </script>
</body>

</html>